{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Aug 2024 -> Aug 2025 percentage change by category (diverging lollipop) with left/right % labels and highest change annotations.",
  "background": "transparent",
  "width": 900,
  "height": 400,

  "data": {
    "values": [
      {"Category":"Permanent arrivals","ChangePct":-5.7},
      {"Category":"Long-term resident returns","ChangePct":-0.6},
      {"Category":"Short-term resident returns","ChangePct":6.0},
      {"Category":"Long-term visitor arrivals","ChangePct":7.8},
      {"Category":"Short-term visitor arrivals","ChangePct":14.3},
      {"Category":"Long-term resident departures","ChangePct":-17.3},
      {"Category":"Short-term resident departures","ChangePct":5.2},
      {"Category":"Long-term visitor departures","ChangePct":5.6},
      {"Category":"Short-term visitor departures","ChangePct":13.7}
    ]
  },

  "transform": [
    {"calculate": "0", "as": "Zero"},
    {"calculate": "datum.ChangePct >= 0 ? 'Increase' : 'Decrease'", "as":"Direction"}
  ],

  "layer": [
    {
      "mark": {"type":"rule", "strokeWidth":2, "opacity":0.6},
      "encoding": {
        "y": {"field":"Category","type":"nominal","sort":"-x","title": null},
        "x": {"field":"Zero","type":"quantitative"},
        "x2": {"field":"ChangePct"},
        "color": {"field":"Direction","type":"nominal","legend": null}
      }
    },
    {
      "mark": {"type":"point", "filled": true, "size": 100},
      "encoding": {
        "y": {"field":"Category","type":"nominal","sort":"-x"},
        "x": {"field":"ChangePct","type":"quantitative","title":"% change (2024 -> 2025)"},
        "color": {"field":"Direction","type":"nominal","legend":{"orient":"bottom"}},
        "tooltip": [
          {"field":"Category"},
          {"field":"ChangePct","type":"quantitative","title":"% change","format":"+.1f"}
        ]
      }
    },

    {
      "transform": [
        {"filter": "datum.Direction === 'Increase'"},
        {"calculate": "format(datum.ChangePct, '+.1f') + '%'", "as": "LabelPos"}
      ],
      "mark": {"type":"text","baseline":"middle","align":"left","dx":8,"fontSize":12,"fontStyle":"italic","fill":"#333","aria": false},
      "encoding": {
        "y": {"field":"Category","type":"nominal","sort":"-x"},
        "x": {"field":"ChangePct","type":"quantitative"},
        "text": {"field":"LabelPos"}
      }
    },
    {
      "transform": [
        {"filter": "datum.Direction === 'Decrease'"},
        {"calculate": "format(datum.ChangePct, '+.1f') + '%'", "as": "LabelNeg"}
      ],
      "mark": {"type":"text","baseline":"middle","align":"right","dx":-8,"fontSize":12,"fontStyle":"italic","fill":"#333","aria": false},
      "encoding": {
        "y": {"field":"Category","type":"nominal","sort":"-x"},
        "x": {"field":"ChangePct","type":"quantitative"},
        "text": {"field":"LabelNeg"}
      }
    },

    {
      "transform": [{"filter": "datum.ChangePct === 14.3"}],
      "mark": {"type": "text", "baseline": "middle", "align": "left", "dx": 80, "fontSize": 12, "fontWeight":"bold", "fill": "#333"},
      "encoding": {
        "y": {"field":"Category","type":"nominal","sort":"-x"},
        "x": {"field":"Zero","type":"quantitative"},
        "text": {"value": "Highest Positive Change"}
      }
    },

    {
      "transform": [{"filter": "datum.ChangePct === -17.3"}],
      "mark": {"type": "text", "baseline": "middle", "align": "right", "dx": -80, "fontSize": 12, "fontWeight":"bold", "fill": "#333"},
      "encoding": {
        "y": {"field":"Category","type":"nominal","sort":"-x"},
        "x": {"field":"Zero","type":"quantitative"},
        "text": {"value": "Highest Negative Change"}
      }
    }
  ],

  "config": {
    "axis": {"grid": true, "tickBand":"extent"},
    "view": {"stroke": "#e8e2d8", "cornerRadius": 8}
  }
}
